{% extends "shop/base.html" %}
{% load i18n %}
{% load satchmo_cart %}
{% load satchmo_currency %}
{% load satchmo_util %}
{% load satchmo_product %}
{% load satchmo_discounts %}
{% load normalize_decimal %}

{% block navbar %}
    <li class="first"><a href="{{shop_base}}/">{% trans "Home" %}</a></li>
    <li>{% trans "Cart" %}</li>
{% endblock %}

{% block content %}

{% if error_message %}
<div class="error">{{ error_message }}</div>
{% endif %}
{% if not cart %}
    <h4>{% trans "Your cart is empty." %}</h4>
{% else %}
    <h4>{% trans "Your Cart" %}</h4>
    <table>
		<thead>
			<tr>
				<th></th>
				<th align="left">{% trans "Quantity" %}</th>
				<th>{% trans "Item" %}</th>
				{% if sale %}
				<th>{% trans "Regular Price" %}</th>
				<th>{% trans "Sale Price" %}
				{% else %}
				<th>{% trans "Price" %}</th>
				{% endif %}
				<th align="center">{% if default_view_tax %}{% trans "Total<br/>(incl.&nbsp;tax)" %}{% else %}{% trans "Total" %}{% endif %}</th>
			</tr>
		</thead>
		<tfoot>
			<tr>
				<td colspan="{% if sale %}5{% else %}4{% endif %}" align="right">{% trans "Cart Total" %}:</td>
				<td>{{ cart|discount_cart_total:sale|currency }}</td>
			</tr>
		</tfoot>
		<tbody>
		{% for cartitem in cart %}
			<tr>
				<td>
				<form action="{% url satchmo_cart_remove %}" method="post">
					<fieldset>
					<input type="hidden" name="cartitem" value="{{ cartitem.id }}" />
					<button type="submit" class="button negative" name="remove">
						<img src="{{ media_url }}images/icons/famfamfam_silk_icons/basket_remove.png" alt="{% trans 'Remove' %}"/> {% trans 'Remove' %}
					</button>
					</fieldset>
				</form>
				</td>
				<td align="center">
				<form class="qtyform" id="form-{{ cartitem.id }}" action="{% url satchmo_cart_set_qty %}" method="post">
					<fieldset>
					<input type="hidden" name="cartitem" value="{{ cartitem.id }}" />
					<input type="text" name="quantity" id="id_quantity_{{ cartitem.id }}" value="{{ cartitem.quantity|normalize_decimal }}" />
					<button type="submit" name="id_update_submit" class="button positive">
						<img src="{{ media_url }}images/icons/famfamfam_silk_icons/basket_edit.png" alt="{% trans 'update amount' %}"/> {% trans 'update amount' %}
					</button>
					</fieldset>
				</form>
				</td>

				{% if sale %}
				<td align="center">{{ cartitem.product.unit_price|currency }}</td>
				{% endif %}
				<td align="center">{{ cartitem.product|discount_price:sale|currency }}</td>
				<td align="center">{{ cartitem|discount_line_total:sale|currency }}</td>
			</tr>
		{% cartitem_custom_details cartitem %}
		{% cartitem_subscription_details cartitem %}
		{% endfor %}
		</tbody>
    </table>
 
    {% if sale %}
	{% include "product/some_discount_eligible.html" %}
	{% endif %}
	
    <a href="{% url satchmo_checkout-step1 %}">{% trans "Check out" %}</a>
{% endif %}
{% endblock %}
